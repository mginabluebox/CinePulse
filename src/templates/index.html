<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CinePulse</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
    <h1 class="text-center">CinePulse</h1>

    <!-- Nav Tabs -->
    <ul class="nav nav-tabs" id="cinePulseTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="recommendations-tab" data-bs-toggle="tab" data-bs-target="#recommendations" type="button" role="tab" aria-controls="recommendations" aria-selected="true">Recommendations</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="movie-picks-tab" data-bs-toggle="tab" data-bs-target="#movie-picks" type="button" role="tab" aria-controls="movie-picks" aria-selected="false">Movie Picks</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="showtimes-tab" data-bs-toggle="tab" data-bs-target="#showtimes" type="button" role="tab" aria-controls="showtimes" aria-selected="false">Search</button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="cinePulseTabsContent">
        <!-- Recommendations Tab -->
        <div class="tab-pane fade show active" id="recommendations" role="tabpanel" aria-labelledby="recommendations-tab">
            
            <div class="card mb-3">
              <div class="card-body">
                <form id="recommendForm" class="mb-0">
                  <div class="mb-3">
                    <label for="mood" class="form-label" >What do you feel like watching?</label>
                    <input id="mood" class="form-control" rows="3" placeholder="e.g. something uplifting, a mind-bender, romantic comedy">
                  </div>
                  <div id="recommendError" class="text-danger small d-none mb-2"></div>
                  <button id="submitRecommend" type="submit" class="btn btn-primary">Get recommendations</button>
                </form>
              </div>
            </div>

                        <div id="recommendResultWrapper" class="d-none">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="mb-0">Recommendations (swipe)</h5>
                                    <div>
                                        <button id="clearRecommend" class="btn btn-sm btn-secondary">Clear</button>
                                    </div>
                                </div>
                                <p class="small text-muted">Swipe right to save / like, swipe left to dismiss. You can also click the Ticket button to open tickets.</p>
                            </div>

                            <div id="cardDeck" class="card-deck-wrapper">
                                <!-- cards will be injected here -->
                                <div id="noRecs" class="text-muted">No recommendations yet — submit the form above.</div>
                            </div>
                                            <div id="swipeSummary" class="mt-3 d-none">
                                                <!-- summary table will be injected here after swipes finish -->
                                            </div>
                        </div>

        </div>

                <!-- Movie Picks (embedding-based) Tab -->
                <div class="tab-pane fade" id="movie-picks" role="tabpanel" aria-labelledby="movie-picks-tab">
                        <div class="card mb-3 mt-3">
                            <div class="card-body">
                                <form id="movieRecommendForm" class="mb-0">
                                    <div class="mb-3">
                                        <label for="movieMood" class="form-label" >What do you feel like watching?</label>
                                        <input id="movieMood" class="form-control" placeholder="e.g. something uplifting, a mind-bender, romantic comedy">
                                    </div>
                                    <div id="movieRecommendError" class="text-danger small d-none mb-2"></div>
                                    <button id="submitMovieRecommend" type="submit" class="btn btn-primary">Get recommendations</button>
                                    <button id="clearMovieRecommend" type="button" class="btn btn-secondary ms-2">Clear</button>
                                </form>
                            </div> 
                        </div>

                        <div id="movieRecommendResultWrapper" class="d-none">
                                <div class="d-flex justify-content-between align-items-center mb-2" id="movieTopHeaderWrapper">
                                    <h5 class="mb-0" id="movieTopHeader">Top matches</h5>
                                </div>
                                <p class="small text-muted" id="movieSwipeHint">Swipe: &larr; dislike, &rarr; like.</p>
                                <div id="movieCards" class="card-deck-wrapper">
                                        <div id="noMovieRecs" class="text-muted">No recommendations yet — submit the form above.</div>
                                </div>
                            <div id="movieSwipeSummary" class="mt-3 d-none"></div>
                        </div>
                </div>

        <!-- Showtimes Tab -->
        <div class="tab-pane fade" id="showtimes" role="tabpanel" aria-labelledby="showtimes-tab">
           
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Show Date</th>
                        <th>Show Time</th>
                        <th>Day</th>
                        <th>Director</th>
                        <th>Year</th>
                        <th>Runtime</th>
                        <th>Format</th>
                        <th>Tickets</th>
                    </tr>
                </thead>
                <tbody>
                    {% for movie in showtimes %}
                    <tr>
                        <td>
                            <a data-bs-toggle="collapse" href="#collapse{{ loop.index }}" role="button" aria-expanded="false" aria-controls="collapse{{ loop.index }}">
                                {{ movie.title }}
                            </a>
                            <div class="collapse" id="collapse{{ loop.index }}">
                                <div class="card card-body">
                                    {{ movie.synopsis }}
                                </div>
                            </div>
                        </td>
                        <td>{{ movie.showdate }}</td>
                        <td>{{ movie.showtime }}</td>
                        <td>{{ movie.show_day }}</td>
                        <td>{{ movie.director }}</td>
                        <td>{{ movie.year }}</td>
                        <td>{{ movie.runtime }} min</td>
                        <td>{{ movie.format }}</td>
                        <td>
                            {% if movie.ticket_link == "sold_out" %}
                                <span class="text-danger">Sold Out</span>
                            {% else %}
                                <a href="{{ movie.ticket_link }}" target="_blank" class="btn btn-primary">{{ movie.cinema }}</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    <!-- Bootstrap & JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>